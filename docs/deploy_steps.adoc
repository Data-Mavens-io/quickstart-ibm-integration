== Deployment steps

=== Step 1. Sign up for a Red Hat Subscription

This Quick Start requires a Red Hat subscription. During the deployment of the Quick Start, you’ll need to provide your https://cloud.redhat.com/openshift/install/aws/installer-provisioned[OpenShift Installer Provisioned Infrastructure pull secret].

If you don’t have an Red Hat account, you can register on the Red Hat website. (Note that registration may require a non-personal email address). To procure a 60-day evaluation license for OpenShift, follow the instructions at https://www.redhat.com/en/technologies/cloud-computing/openshift/try-it[Evaluate Red Hat OpenShift Container Platform].

The https://cloud.redhat.com/openshift/install/aws/installer-provisioned[OpenShift pull secret] should be uploaded to an S3 bucket. The Quick Start will pull this secret file from the specified S3 bucket location to provision the cluster.

=== 

=== Step 2. Cloud Pak for Integration Subscription

The Quick Start requires an entitlement key to allow you to access the Cloud Pak for Integration content. If you don’t have a paid entitlement you can access a https://www.ibm.com/account/reg/uk-en/signup?formid=urx-46640[60 day trial subscription key].

To use the Cloud Pak for Integration beyond this 60 day period please contact IBM sales, an IBM approved Business Partner, or the Red Hat Marketplace to buy licensed entitlement to Cloud Pak for Integration.

=== Step 3. Storage Subscription

The Quick Start uses OpenShift Container Storage (OCS) as technology to provide persistent storage for its capabilities and runtimes. You have an option to use an evaluation version of OCS. Visit https://www.openshift.com/products/container-storage/contact[OpenShift Container Storage] for their licensed versions.

=== Step 4. Sign in to your AWS account

[arabic]
. Sign in to your AWS account at https://aws.amazon.com with an AWS Identity and Access Management (IAM) user role that has the necessary permissions. For details, see link:#_Planning_the_deployment[Planning the deployment], earlier in this guide.
. Make sure that your AWS account is configured correctly, as discussed in link:#_Technical_requirements[Technical requirements], earlier in this guide.
. Use the Region selector in the navigation bar to choose the AWS Region where you want to deploy Cloud Pak for Integration on AWS. An IBM Cloud Pak for Integration high availability deployment is restricted to AWS Regions with at least three Availability Zones.
. The following resources should be made available for Cloud Pak for Integration deployment:

* A key pair to SSH to the cluster nodes. In the navigation pane of the https://console.aws.amazon.com/ec2/[Amazon EC2 console], click *Key Pairs*, and then select your key pair from the list.
* A new or an existing S3 Bucket location with Red Hat pull secret.
* A new or an existing https://console.aws.amazon.com/route53/home[Route 53] domain and a Hosted Zone ID, which will be used for adding DNS records for Cloud Pak for Integration applications.
* An existing S3 Bucket to store deployment log files.

=== Step 3. Launch the Quick Start

*Notes* The instructions in this section reflect the older version of the AWS CloudFormation console. If you’re using the redesigned console, some of the user interface elements might be different.

You are responsible for the cost of the AWS services used while running this Quick Start reference deployment. There is no additional cost for using this Quick Start. For full details, see the pricing pages for each AWS service you will be using in this Quick Start. Prices are subject to change.

[arabic, start=5]
. Launch the AWS CloudFormation template into your AWS account.

[cols=",",]
|===
|https://fwd.aws/r9QRP[[line-through]*Deploy Cloud Pak for Data into a* +
[line-through]*new VPC on AWS*] |https://fwd.aws/6zgYY[[line-through]*Deploy Cloud Pak for Data into an* +
[line-through]*existing VPC on AWS*]
|===

A Cloud Pak for Integration standard deployment takes about 2 hours[line-through]*.*

[arabic]
. Check the Region that’s displayed in the upper-right corner of the navigation bar and change it if necessary. This is where the network infrastructure for Cloud Pak for Integration will be built. The template is launched in the US East (Ohio) Region by default.

*Note* The Cloud Pak for Integration on AWS Quick Start is limited to Regions that have Amazon EBS service available. For a current list of supported Regions, see the https://docs.aws.amazon.com/general/latest/gr/ebs-service.html[endpoints and quotas webpage]. Running in HA configuration is supported only in Regions with at least three Availability Zones.

[arabic, start=2]
. On the *Create stack* page, keep the default setting for the template URL, and then choose *Next*.
. On the *Specify stack details* page, change the stack name if needed. Review the parameters for the template. Provide values for the parameters that require input. For all other parameters, review the default settings and customize them as necessary.

In the following tables, parameters are listed by category and described separately for the two deployment options:

* link:#option-1-parameters-for-deploying-cloud-pak-for-integration-into-a-new-vpc[Parameters for deploying Cloud Pak for Data into a new VPC]
* link:#option-2-parameters-for-deploying-cloud-pak-for-integration-into-an-existing-vpc[Parameters for deploying Cloud Pak for Data into an existing VPC]

When you finish reviewing and customizing the parameters, choose *Next*.

==== Option 1: Parameters for deploying Cloud Pak for Integration into a new VPC

https://fwd.aws/G534P[View template]

____
_VPC network configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Number of Availability Zones +
(*NumberOfAZs*) |3 |The number of Availability Zones to be used for the deployment. Keep in mind that some Regions may be limited to two Availability Zones. For a single IBM Cloud Pak for Integration cluster to be highly available, three Availability Zones are needed to avoid a single point of failure when using three, five, or seven master nodes or etcd nodes. With fewer than three Availability Zones, one of the Availability Zones will have more master nodes (or etcd nodes) than can be lost without losing a majority of the etcd instances. Allowed values: 1, 3
|Availability Zones +
(*AvailabilityZones*) |_Requires input_ |The list of Availability Zones to use for the subnets in the VPC. The Quick Start uses one or three Availability Zones and preserves the logical order you specify.
|VPC CIDR +
(VPCCIDR) |10.0.0.0/16 |The CIDR block for the VPC to be created.
|Private subnet 1 CIDR +
(PrivateSubnet1CIDR) |10.0.0.0/19 |The CIDR block for the private subnet located in Availability Zone 1.
|Private subnet 2 CIDR +
(PrivateSubnet2 +
CIDR) |10.0.32.0/19 |The CIDR block for the private subnet located in Availability Zone 2.
|Private subnet 3 CIDR +
(PrivateSubnet3CIDR) |10.0.64.0/19 |The CIDR block for the private subnet located in Availability Zone 3.
|Public subnet 1 CIDR +
(PublicSubnet1CIDR) |10.0.128.0/20 a|
____
The CIDR block for the public subnet located in Availability Zone 1.
____

|Public subnet 2 CIDR +
(PublicSubnet2CIDR) |10.0.144.0/20 |The CIDR block for the public subnet located in Availability Zone 2
|Public subnet 3 CIDR +
(PublicSubnet3CIDR) |10.0.160.0/20 |The CIDR block for the public subnet located in Availability Zone 3.
a|
BootNodeAccessCIDR

(BootNodeAccessCIDR

)

|_Requires input_ |The CIDR IP range that is permitted to access the Boot Node instance. We recommend that you set this value to a trusted IP range. The value `0.0.0.0/0` permits all IP addresses to access. Additional values can be added post-deployment from the Amazon EC2 console.
|===

____
_DNS configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Domain name +
(DomainName) |_Requires input_ |The domain name configured for the cluster. For more detail take a look https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account[here].
|===

____
_Amazon EC2 configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Key pair name +
(KeyPairName) |_Requires input_ |The name of an existing public/private key pair, which allows you to securely connect to your instance after it launches.
|===

____
_OpenShift hosts configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Number of master nodes +
(NumberOfMaster) |3 |The desired capacity for the OpenShift master instances. Must be an odd number. For a development deployment, 1 is sufficient; for production deployments, a minimum of 3 is required.
|Number of compute nodes +
(NumberOfNodes) |3 a|
The desired capacity for the OpenShift node instances. Minimum of 3 nodes required.

*Warning* If the number of node instances exceeds your Red Hat entitlement limits or AWS instance quotas, the stack will fail. Choose a number that is within your limits.

|Master instance type +
(MasterInstanceType) |m5.2xlarge |The EC2 instance type for the OpenShift master instances.
|Nodes instance type +
(NodesInstanceType) |m5.8xlarge |The EC2 instance type for the OpenShift node instances.
|Cloud Pak for Integration UI password +
(*AdminPassword*) |_Requires input_ |The password for the Cloud Pak for Integration web client. The password must contain at least 8 characters, including letters (with a minimum of one capital letter), numbers, and symbols.
|Cluster name +
(*ClusterName*) |_Requires input_ |The OpenShift cluster name.
|===

_Storage Configuration:_

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Dedicated Storage nodes for OCS |_false_ |Choose *True* to deploy dedicated OCS nodes. Setting this value to False causes OCS to be deployed in hyper-converged fashion on the same worker nodes as the Cloud Pak for Integration workload, and so will require those worker nodes to be larger in size than in the case where dedicated OCS node are used (i.e.: for hyper-converged mode the suggested instance is m5.8xlarge)
a|
OCS instance type

(OCSInstanceType)

|*m4.4xlarge* |*The EC2 instance type for the OpenShift Container Storage instances.*
a|
Number of OCS nodes

(NumberOfOCS)

|3 |The desired number of dedicated OpenShift Container Storage instances. Minimum of 3 is required. (not applicable if if dedicated nodes is set to False.
|===

____
_Red Hat subscription information:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|RedHat subscription pull secret. (RedhatPullSecret) |_Requires input_ |S3 path of OpenShift Installer Provisioned Infrastructure pull secret(e.g., s3://my-bucket/path/to/pull-secret).
|===

____
_IBM Cloud Pak for Integration configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|IBM Cloud Pak for Integration version |2020.3 |The version of Cloud Pak for Integration to be deployed. Currently only v 2020.3 is supported.
|IBM Cloud Pak for Integration Username +
(*APIUsername*) |cp |Enter the IBM Cloud Pak for Integration Username value to access IBM Container Registry.
|IBM Cloud Pak for Integration Entitlement Key (*APIKey*) |*Requires Input* |Enter the IBM Cloud Pak for Integration API key to access IBM Container Registry.
|License agreement +
(*LicenseAgreement*) |— |Choose *Accept* to acknowledge that you have read and agree to the license terms for Cloud Pak for Integration (https://http://ibm.biz/BdqSw4[ibm.biz/BdqSw4])
|OpenShift project +
(*NameSpace*) |cp4i |The OpenShift project that will be created for deploying Cloud Pak for Integration. It can be any lowercase string.
a|
Asset Repository

(AR)

|False |Choose *True* to install an example instance of the *Asset Repository capability.*
a|
Operations Dashboard

(OD)

|False |Choose *True* to install an example instance of the *Operations Dashboard* *capability*.
|API Lifecycle and Management +
(*APILM*) |False |Choose *True* to install an example instance of the *API Lifecycle and Management capability* .
|Application Integration Dashboard (AIDB) |False |Choose *True* to install an example instance of the *Application Integration Dashboard capability*.
|Application Integration Designer +
(*AIDE*) |False |Choose *True* to install an example instance of the *Application Integration Designer* *capability*.
|Messaging (MQ) |False |Choose *True* to install an example instance of the *Messaging runtime.*
|Event Streaming +
(*ES*) |False |Choose *True* to install an example instance of the *Event Streaming runtime.*
|Gateway (GW) |*False* |Choose *True* to install an example instance of the *Gateway runtime.*
|High Speed Transfers (HST) |*False* a|
Choose *True* to install an example instance of the *High Speed Transfer*

*runtime.*

|===

____
_AWS Quick Start configuration:_
____

*Note* We recommend that you keep the default settings for the following two parameters, unless you are customizing the Quick Start templates for your own deployment projects. Changing the settings of these parameters will automatically update code references to point to a new Quick Start location. For additional details, see the https://aws-quickstart.github.io/option1.html[AWS Quick Start Contributor’s Guide].

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Quick Start S3 bucket name +
(*QSS3BucketName*) |aws-quickstart |The S3 bucket you created for your copy of Quick Start assets, if you decide to customize or extend the Quick Start for your own use. The bucket name can include numbers, lowercase letters, uppercase letters, and hyphens, but should not start or end with a hyphen.
|Quick Start S3 key prefix +
(*QSS3KeyPrefix*) |quickstart-ibm-icp-for-integration/ |The https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingMetadata.html[S3 key name prefix] used to simulate a folder for your copy of Quick Start assets, if you decide to customize or extend the Quick Start for your own use. This prefix can include numbers, lowercase letters, uppercase letters, hyphens, and forward slashes.
a|
Quick Start S3 bucket region

(QSS3BucketRegion)

|us-east-1 |The AWS Region where the Quick Start S3 bucket (QSS3BucketName) is hosted. When using your own bucket, you must specify this value.
|Output S3 bucket name (*OutputBucketName*) |_Requires Input_ |The Existing S3 bucket name where the zip file output should be placed.
|===

==== Option 2: Parameters for deploying Cloud Pak for Integration into an existing VPC

https://fwd.aws/WNbyg[[line-through]*View template*]

____
_Network configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Number of Availability Zones +
(*NumberOfAZs*) |3 |The number of Availability Zones to be used for the deployment. Keep in mind that some Regions may be limited to two Availability Zones. For a single IBM Cloud Pak for Integration cluster to be highly available, three Availability Zones are needed to avoid a single point of failure when using three, five, or seven master nodes or etcd nodes. With fewer than three Availability Zones, one of the Availability Zones will have more master nodes (or etcd nodes) than can be lost without losing a majority of the etcd instances. Allowed values: 1, 3
|VPC ID +
(*VPCID*) |_Requires input_ |The ID of your existing VPC for deployment.
|VPC CIDR +
(*VPCCIDR*) |_Requires input_ |The CIDR block for the VPC to be created.
|Private subnet 1 ID +
(*PrivateSubnet1ID*) |_Requires input_ |The ID of the private subnet in Availability Zone 1 for the workload (e.g., subnet-a0246dcd).
|Private subnet 2 ID +
(*PrivateSubnet2ID*) |_Requires input_ |The ID of the private subnet in Availability Zone 2 for the workload (e.g., subnet-b1f432cd).
|Private subnet 3 ID +
(*PrivateSubnet3ID*) |_Requires input_ |The ID of the private subnet in Availability Zone 3 for the workload (e.g., subnet-b1f4a2cd).
|Public subnet 1 ID +
(*PublicSubnet1ID*) |_Requires input_ |The ID of the public subnet in Availability Zone 1 for the ELB load balancer (e.g., subnet-9bc642ac).
|Public subnet 2 ID +
(*PublicSubnet2ID*) |_Requires input_ |The ID of the public subnet in Availability Zone 2 for the ELB load balancer (e.g., subnet-e3246d8e).
|Public subnet 3 ID +
(*PublicSubnet3ID*) |_Requires input_ |The ID of the public subnet in Availability Zone 3 for the ELB load balancer (e.g., subnet-e324ad8e).
a|
BootNodeAccessCIDR

(BootNodeAccessCIDR

)

|_Requires input_ |The CIDR IP range that is permitted to access the Boot Node instance. We recommend that you set this value to a trusted IP range. The value `0.0.0.0/0` permits all IP addresses to access. Additional values can be added post-deployment from the Amazon EC2 console.
|===

____
_DNS configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Domain name +
(DomainName) |_Requires input_ |The domain name configured for the cluster. For more detail take a look https://docs.openshift.com/container-platform/4.5/installing/installing_aws/installing-aws-account.html#installation-aws-route53_installing-aws-account[here].
|===

____
_Amazon EC2 configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Key pair name +
(KeyPairName) |_Requires input_ |The name of an existing public/private key pair, which allows you to securely connect to your instance after it launches.
|===

____
_OpenShift hosts configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Number of master nodes +
(NumberOfMaster) |3 |The desired capacity for the OpenShift master instances. Must be an odd number. For a development deployment, 1 is sufficient; for production deployments, a minimum of 3 is required.
|Number of compute nodes +
(NumberOfNodes) |3 a|
The desired capacity for the OpenShift node instances. Minimum of 3 nodes required.

*Warning* If the number of node instances exceeds your Red Hat entitlement limits or AWS instance quotas, the stack will fail. Choose a number that is within your limits.

|Master instance type +
(MasterInstanceType) |m5.2xlarge |The EC2 instance type for the OpenShift master instances.
|Nodes instance type +
(NodesInstanceType) |m5.8xlarge |The EC2 instance type for the OpenShift node instances.
|Cloud Pak for Integration UI password +
(*AdminPassword*) |_Requires input_ |The password for the Cloud Pak for Data web client. The password must contain at least 8 characters, including letters (with a minimum of one capital letter), numbers, and symbols.
|Cluster name +
(*ClusterName*) |_Requires input_ |The OpenShift cluster name.
|===

_Storage Configuration:_

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Dedicated Storage nodes for OCS |_false_ |Choose *True* to deploy dedicated OCS nodes. Setting this value to False causes OCS to be deployed in hyper-converged fashion on the same worker nodes as the Cloud Pak for Integration workload, and so will require those worker nodes to be larger in size than in the case where dedicated OCS node are used (i.e.: for hyper-converged mode the suggested instance is m5.8xlarge)
a|
OCS instance type

(OCSInstanceType)

|*m4.4xlarge* |*The EC2 instance type for the OpenShift Container Storage instances.*
a|
Number of OCS nodes

(NumberOfOCS)

|3 |The desired number of dedicated OpenShift Container Storage instances. Minimum of 3 is required. (not applicable if if dedicated nodes is set to False.
|===

____
_Red Hat subscription information:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|RedHat subscription pull secret(RedhatPullSecret) |_Requires input_ |S3 path of OpenShift Installer Provisioned Infrastructure pull secret(e.g., s3://my-bucket/path/to/pull-secret).
|===

____
_IBM Cloud Pak for Integration configuration:_
____

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|IBM Cloud Pak for Integration version |2020.3 |The version of Cloud Pak for Integration to be deployed. Currently only v 2020.3 is supported.
|IBM Cloud Pak for Integration Username +
(*APIUsername*) |cp |Enter the IBM Cloud Pak for Integration Username value to access IBM Container Registry.
|IBM Cloud Pak for Integration Entitlement Key (*APIKey*) |*Requires Input* |Enter the IBM Cloud Pak for Integration API key to access IBM Container Registry.
|License agreement +
(*LicenseAgreement*) |— |Choose *Accept* to acknowledge that you have read and agree to the license terms for Cloud Pak for Integration (https://http://ibm.biz/BdqSw4[ibm.biz/BdqSw4])
|OpenShift project +
(*NameSpace*) |cp4i |The OpenShift project that will be created for deploying Cloud Pak for Integration. It can be any lowercase string.
a|
Asset Repository

(AR)

|False |Choose *True* to install an example instance of the *Asset Repository capability.*
a|
Operations Dashboard

(OD)

|False |Choose *True* to install an example instance of the *Operations Dashboard* *capability*.
|API Lifecycle and Management +
(*APILM*) |False |Choose *True* to install an example instance of the *API Lifecycle and Management capability* .
|Application Integration Dashboard (AIDB) |False |Choose *True* to install an example instance of the *Application Integration Dashboard capability*.
|Application Integration Designer +
(*AIDE*) |False |Choose *True* to install an example instance of the *Application Integration Designer* *capability*.
|Messaging (MQ) |False |Choose *True* to install an example instance of the *Messaging runtime.*
|Event Streaming +
(*ES*) |False |Choose *True* to install an example instance of the *Event Streaming runtime.*
|Gateway (GW) |*False* |Choose *True* to install the *Gateway runtime.*
|High Speed Transfers (HST) |*False* a|
Choose *True* to install the *High Speed Transfers*

*runtime.*

|===

____
_AWS Quick Start configuration:_
____

*Note* We recommend that you keep the default settings for the following two parameters, unless you are customizing the Quick Start templates for your own deployment projects. Changing the settings of these parameters will automatically update code references to point to a new Quick Start location. For additional details, see the https://aws-quickstart.github.io/option1.html[AWS Quick Start Contributor’s Guide].

[cols=",,",options="header",]
|===
|Parameter label (name) |Default |Description
|Quick Start S3 bucket name +
(*QSS3BucketName*) |aws-quickstart |The S3 bucket you created for your copy of Quick Start assets, if you decide to customize or extend the Quick Start for your own use. The bucket name can include numbers, lowercase letters, uppercase letters, and hyphens, but should not start or end with a hyphen.
a|
Quick Start S3 bucket region

(QSS3BucketRegion)

|us-east-1 |The AWS Region where the Quick Start S3 bucket (QSS3BucketName) is hosted. When using your own bucket, you must specify this value.
|Quick Start S3 key prefix +
(*QSS3KeyPrefix*) |quickstart-ibm-cp-for-integration |The https://docs.aws.amazon.com/AmazonS3/latest/dev/UsingMetadata.html[S3 key name prefix] used to simulate a folder for your copy of Quick Start assets, if you decide to customize or extend the Quick Start for your own use. This prefix can include numbers, lowercase letters, uppercase letters, hyphens, and forward slashes.
|Output S3 bucket name +
(*OutputBucketName*) |_Requires Input_ |The Existing S3 bucket name where the zip file output should be placed.
|===

[arabic, start=4]
. On the options page, you can https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/aws-properties-resource-tags.html[specify tags] (key-value pairs) for resources in your stack and https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/cfn-console-add-tags.html[set advanced options]. When you’re done, choose *Next*.
. On the *Review* page, review and confirm the template settings. Under *Capabilities*, select the check box to acknowledge that the template will create IAM resources.
. Choose *Create stack* to deploy the stack.
. Monitor the status of the stack. When the status is *CREATE_COMPLETE*, the Cloud Pak for Integration cluster is ready.
. Use the URLs displayed in the *Outputs* tab for the stack to view the resources that were created. The URL for the *CPKIWebClientURL* output key will navigate to the console login page.

=== Step 4. (Optional) Edit the application security group

Optional: You might need to edit the AWS application group to add IP addresses that can access the Cloud Pak for Integration user interface.

The Cloud Pak for Integration infrastructure nodes control access to the applications that are running in the pods deployed on the compute nodes. The k8s-elb-

parameter controls access to the application nodes. This section describes the steps to modify the BootnodeSecurityGroup ingress rules.

[arabic]
. From EC2 dashboard select Security Groups .

image:extracted-media/media/image1.png[Graphical user interface, application Description automatically generated,width=648,height=136]

[arabic, start=2]
. Select Security Group name starting with k8s-elb

image:extracted-media/media/image2.png[Graphical user interface, application Description automatically generated,width=648,height=111]

[arabic, start=3]
. The security group window displays the ingress rules. Select the *Inbound* tab, and then choose *Edit inbound rules* to bring up the rule editor.

image:extracted-media/media/image3.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=308]

[arabic, start=4]
. Choose *Add Rule*, and fill in the rule details. For the rule *Type*, select either HTTP or HTTPS in the drop-down menu. Port 80 or 443 is filled in automatically. Add the network CIDR for the group of IP addresses that you want to permit HTTP or HTTPS access to the proxy nodes. To allow any IP address, use 0.0.0.0/0.

image:extracted-media/media/image4.png[Graphical user interface, application Description automatically generated,width=648,height=289]

[arabic, start=5]
. In the rule editor window, choose *Save*.

=== Step 6. Test the deployment by using the Cloud Pak for Integration user interface

When the AWS CloudFormation template has successfully created the stack, all server nodes are running with the software installed in your AWS account. In the following steps, connect to Cloud Pak for Integration web client to verify the deployment, and then use the web client to explore Cloud Pak for Integration features.

[arabic]
. To access the Cloud Pak for Integration user interface, go to the *CPKIWebClientURL* output of the root stack.

image:extracted-media/media/image5.png[Graphical user interface, text, application, email, Teams Description automatically generated,width=648,height=290]

[arabic, start=2]
. A new tab opens in your browser. If you configured the hostname resolution for the cluster DNS name in the URL, you see either the Cloud Pak for Integration web client login page or a warning from your browser that the HTTPS connection is not safe. By default, the public key infrastructure (PKI) certificate that is created for the Cloud Pak for Integration cluster is self-signed, which causes the unsafe connection warning from your browser.
. Log in to the Cloud Pak for Integration web client by using the default user admin and the password you supplied when creating the stack.
. Once you log in, the welcome page is displayed.

image:extracted-media/media/image6.png[Graphical user interface Description automatically generated,width=648,height=281]

____
See https://www.ibm.com/demos/search/?product=Cloud+Pak+for+Integration&page=1&products=Cloud+Pak+for+Integration[IBM Demos – Cloud Pak for Integration] for videos and other resources to help you understand the platform features and capabilities.
____

=== Step 6. Manage your cluster using the OpenShift Console

____
[line-through]*To access the Cloud Pak for Integration web client, go to the *OpenShiftUI* output of the root stack*

The default OpenShift administrative user is *kubeadmin.* You obtain the password from the OpenshiftSecret resource created as shown in the figure.

image:extracted-media/media/image7.png[Graphical user interface, text, application, email Description automatically generated,width=648,height=442]

You retrieve the secret value by clicking *Retrieve secret value* as shown below, and use the value for the OpenShift console administrative password.
____

image:extracted-media/media/image8.png[Graphical user interface, text, application, Teams Description automatically generated,width=648,height=176]

=== Step 7. (Optional) Provide Boot Node SSH access

The BootNodeInstance is used for certain command-line cluster administration tasks, such as adding compute nodes. SSH access to the boot node is required for some cluster administrators.

After deployment, you only have access to the boot node. Provide the workstation IP address CIDR as the value of the BootNodeSecurityGroup rule.

This section describes the steps to modify the BootNodeSecurityGroup inbound rules.

*Note* These steps assume access to the AWS CloudFormation console for the IBM Cloud Pak for Integration deployment.

[arabic]
. In the list of stacks created, choose the stack named *CloudPakDataStack*.

image:extracted-media/media/image9.png[Graphical user interface, text, application, email Description automatically generated,width=270,height=232]

[arabic, start=2]
. In the stack window, choose the Resources tab, and select BootNodeSecurityGroup.

image:extracted-media/media/image10.png[Graphical user interface, text, application, email Description automatically generated,width=648,height=420]

[arabic, start=3]
. The security group window displays the ingress rules. Click the Inbound tab, and click Edit to bring up the rule editor.

image:extracted-media/media/image11.png[A picture containing graphical user interface, application Description automatically generated,width=648,height=101]

[arabic, start=4]
. Choose Add Rule, and fill in the rule details. Add the network CIDR for the group of IP addresses that you want to permit SSH access to the boot nodes. To allow any IP address, use 0.0.0.0/0.

image:extracted-media/media/image12.png[image,width=648,height=30]

[arabic, start=5]
. In the rule editor window, choose Save.

== Accessing the control plane through the Boot Node

The recommended method of SSH access to the OpenShift cluster instances via the bastion host is by using SSH agent forwarding, as in the following Bash instructions:

[arabic, start=6]
. Run the command ssh-add -K <your-key.pem> to store the key in your keychain. On Linux, you might need to omit the -K flag.
. Retrieve the host name of the Boot Node from the Amazon EC2 console.

image:extracted-media/media/image13.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=348]

[arabic, start=9]
. To log in to the bastion host, run ssh -A ec2-user@<bootnode-host-name>.
. Run sudo to become root:

____
$ sudo -s
____

[arabic, start=11]
. Run oc login to authenticate with OpenShift and oc get pods, and verify that services are in a running state:

____
$ oc login

$ oc get pods
____

== Scaling up your cluster by adding compute nodes

* Run oc nodes to get the current list of nodes
* Run oc get machineset -n openshift-machine-api to get the machinesets for each Availability zone.

image:extracted-media/media/image14.png[Text Description automatically generated,width=648,height=93]

* Select the machine set to scale up from the list returned in previous command
* Edit selected machine set and update replica count as below:

____
oc edit machineset cp4i-pn-nk9dr-worker-eu-west-1a -n openshift-machine-api
____

image:extracted-media/media/image15.png[Text Description automatically generated,width=648,height=216]

* An AWS instance will be created and Desired count and current count will get updated to replica value.
* After few mins once the node joins the cluster ready and available count will be updated to replica value.

*Note*

[arabic]
. If you choose to scale down your cluster or reduce the number of compute nodes, there is a risk of the cluster becoming unstable because pods will need to be rescheduled. Scaling down the worker nodes is not a recommended option.
. Cluster auto scaler can overrule the scaling activity to maintain the required threshold.

== Cloud Pak for Integration services

You can browse the various services that are available for use by navigating to the https://www.ibm.com/support/knowledgecenter/SSGT7J_20.3/install/deploying.html[Cloud Pak for Integration Platform Navigator].

image:extracted-media/media/image16.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=295]

image:extracted-media/media/image17.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=206]

As part of the Quick Start installation, the Platform Navigator is installed by default, giving you the ability to choose which of the capabilities and runtimes you wish to create after the deployment has completed.

=== System requirements for each of the capabilities and services

[cols=",,",options="header",]
|===
|Service Name |CPU cores( vCPUs) |Memory
|Asset Repository |0.5 |640MG
|Operations Dashboard |7 |13GB
|*API Lifecycle and Management* |12 |48GB
|*Messaging (Queue Manager)* |1 |1GB
|*Event Streaming* |8.2 |8.2GB
|*Application Integration Dashboard* |1 |4GB
|*Application Integration Designer* |1 |5.75GB
|*Gateway* |4 |4GB
|*High Speed Transfers* |4 |4GB
|===

=== Install a Service

* Log in to your bootnode server as mentioned in access section.
* Change to the install directory.

____
$ cd /ibm
____

* Run these commands in sequence:

____
$ ./cpd-linux adm -r ./repo.yaml -a <Service Name> -n <Project Name> --apply

$ ./cpd-linux -c <Storage Class> -r ./repo.yaml -a lite -n <Project Name> --transfer-image-to $(oc get route -n openshift-image-registry | tail -1| awk '\{print $2}')/<Project Name> --target-registry-username $(oc whoami | sed 's/://g') --target-registry-password $( oc serviceaccounts get-token cpdtoken) --cluster-pull-prefix image-registry.openshift-image-registry.svc:5000/<Project Name> -o override.yaml --insecure-skip-tls-verify

Installing capabilities as standalone installation

Installation from Platform Navigator UI
____

* Log in to the Platform Navigator UI and click   *Capabilities,* then click *Create capability.*

image:extracted-media/media/image18.png[Graphical user interface, application Description automatically generated,width=648,height=168]

* Select a capability to create, for example, *Operations Dashboard,*.   and *click Create.*

image:extracted-media/media/image19.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=293]

* Select *Select type,* then click the tile that suits your use case, either *Development* or *Production.* Click *Next.* 

____
image:extracted-media/media/image20.png[Graphical user interface, application Description automatically generated,width=648,height=226]
____

* Select *Configuration,* then enter the appropriate values in the configuration form. Click *Create.* +
image:extracted-media/media/image21.png[Graphical user interface, application, Teams Description automatically generated,width=648,height=497]
* The capability displays as *Pending* in the *Status* column.Pending Status  +
image:extracted-media/media/image22.png[A picture containing table Description automatically generated,width=648,height=159]

To trace installation progress, go to the OpenShift admin console and click *Events* in the left navigation menu, as shown: +
image:extracted-media/media/image23.png[Graphical user interface, application Description automatically generated,width=648,height=235]

* In the Platform Navigator UI, when the capability displays *as* Ready in *the* Status column, it is fully installed.  +
image:extracted-media/media/image24.png[A picture containing graphical user interface Description automatically generated,width=648,height=158] 

____
Installation from AWS bootnode
____

=== Installation from AWS Bootnode

* Login to your AWS bootnode server.
* Navigate to scripts directory.

cd /ibm/cp4i-deployment/capabilities-runtimes-scripts

* Run the command for the desired capability. Below are examples for each:

____
1- Operations Dashboard

./release-tracing.sh -n $\{namespace} -r $\{release_name} -f $\{file_storage} -b $\{block_storage} -p

# -p is optional flag, adding it installs the capability in production mode

For xample:

./release-tracing.sh -n integration -r operations-dashboard -f ocs-storagecluster-cephfs -b gp2 -p

2- API Connect

./release-apic.sh -n $\{namespace} -r $\{release_name} -p

# -p is optional flag, adding it installs the capability in production mode

For example:

./release-apic.sh -n integration -r api-connect -p

3- App Connect Dashboard

./release-ace-dashboard.sh -n $\{namespace} -r $\{release_name} -s $\{storageClass} -p

# -p is optional flag, adding it installs the capability in production mode

For example:

./release-ace-dashboard.sh -n integration -r app-connect-dashboard -s ocs-storagecluster-cephfs -p

4- App Connect Designer

./release-ace-designer.sh -n $\{namespace} -r $\{release_name} -s $\{storageClass} -p

# -p is optional flag, adding it installs the capability in production mode

For example:

./release-ace-designer.sh -n integration -r app-connect-designer -s ocs-storagecluster-cephfs -p

5- Asset Repository

./release-ar.sh -n $\{namespace} -r $\{release_name} -a $\{assetDataVolumeClass} -c $\{couchVolumeClass}

# -p is optional flag, adding it installs the capability in production mode

For example:

./release-ar.sh --n integration -r assets-repo -a ocs-storagecluster-cephfs -c ocs-storagecluster-cephfs -p
____

* The capability now displays as *Pending* in the *Status* column.  +
image:extracted-media/media/image22.png[A picture containing table Description automatically generated,width=648,height=159]
* To trace installation progress, go to the OpenShift admin console and click *Events* in the left navigation menu, as shown: +
image:extracted-media/media/image23.png[Graphical user interface, application Description automatically generated,width=624,height=226]

____
In the Platform Navigator UI, when the capability displays as *Ready* in the *Status* column, it is fully installed.  +
image:extracted-media/media/image24.png[A picture containing graphical user interface Description automatically generated,width=648,height=158] 
____

To get information on other services that are available, see the https://www.ibm.com/support/knowledgecenter/SSGT7J_20.3/install/deploying.html[Deployment Component Products].
